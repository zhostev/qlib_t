# 实现计划

## 1. 去掉 Profit-Loss 页面

### 前端修改
- **App.tsx**: 删除第10行的ProfitLoss导入和第40行的profit-loss路由配置
- **Navigation.tsx**: 删除第111-115行的"收益情况"导航菜单项
- **删除文件**: 删除 `/home/idea/code/qlib_t/frontend/src/pages/ProfitLoss.tsx` 文件

## 2. 补充完整用户信息

### 后端修改
- **修改用户模型**: 在 `/home/idea/code/qlib_t/backend/app/models/user.py` 中添加以下字段：
  - `email`: 邮箱字段
  - `full_name`: 全名
  - `role`: 角色字段（用于权限控制）
  - `disabled`: 禁用状态
  - `last_login`: 最后登录时间

- **更新用户Schema**: 在 `/home/idea/code/qlib_t/backend/app/schemas/user.py` 中添加相应的字段

- **修改认证API**: 更新 `/home/idea/code/qlib_t/backend/app/api/auth.py` 中的用户信息获取接口

### 前端修改
- **更新用户信息展示**: 在 `Navigation.tsx` 中完善用户信息展示
- **添加用户管理页面**: 创建用户管理组件，用于编辑用户信息

## 3. 实现权限系统

### 后端修改
- **添加角色枚举**: 创建角色枚举类型（管理员、查看者、开发者等）
- **修改用户模型**: 添加 `role` 字段
- **添加权限依赖**: 在 `/home/idea/code/qlib_t/backend/app/api/deps.py` 中添加权限检查依赖
- **更新API路由**: 为各API路由添加权限装饰器

### 前端修改
- **添加权限检查**: 在路由和组件中添加权限检查
- **动态渲染导航**: 根据用户角色动态渲染导航菜单
- **添加权限控制组件**: 创建权限控制HOC（高阶组件）

## 4. 开发后端管理页面

### 前端修改
- **创建管理页面**: 在 `/home/idea/code/qlib_t/frontend/src/pages` 中创建 `Admin.tsx` 页面
- **添加管理导航项**: 在 `Navigation.tsx` 中添加管理导航项，仅对管理员可见
- **实现用户管理功能**: 在管理页面中实现用户列表、添加用户、编辑用户、删除用户等功能
- **实现权限管理功能**: 在管理页面中实现角色分配功能

### 后端修改
- **添加管理员API**: 创建管理员相关的API路由，用于管理用户和权限
- **添加权限检查**: 为管理员API添加权限检查

## 5. 数据库迁移

- **运行迁移命令**: 生成并应用数据库迁移，更新用户表结构

## 6. 测试

- **测试权限控制**: 验证不同角色用户只能访问对应的页面和API
- **测试用户管理**: 验证管理员可以正常管理用户和权限
- **测试页面访问**: 验证profit-loss页面已被成功移除

## 实现顺序

1. 先去掉profit-loss页面
2. 然后修改用户模型，补充用户信息
3. 接着实现权限系统
4. 最后开发后端管理页面
5. 进行测试和验证

这个计划将确保我们按照合理的顺序实现用户的所有需求，同时保持代码的可维护性和扩展性。