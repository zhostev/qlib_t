## 修复系统问题的计划

### 1. 因子管理：Failed to fetch data 问题
**问题原因**：数据库中 `factors` 表缺少 `group_id` 字段，导致查询失败
**解决方案**：
- 修改 `get_factors` 函数，添加异常处理，避免在旧数据库上运行时出错
- 或者修改数据库初始化脚本，确保 `factors` 表有 `group_id` 字段

### 2. 创建用户失败问题
**问题原因**：请求数据不符合 `UserCreate` schema 验证要求，返回 422 错误
**解决方案**：
- 检查前端发送的请求数据，确保符合 schema 要求
- 或者修改 `UserCreate` schema，放宽某些验证要求（如允许 `email` 为空）

### 3. 数据来源问题
**问题原因**：当前使用的是模拟数据，没有从 QLib 实际加载数据
**解决方案**：
- 修改 `init_db.py` 脚本，使用 `qlib_service.py` 中的方法从 QLib 加载实际数据
- 确保 `qlib_service.py` 中的 `get_stock_data` 方法能够正确从 QLib 获取数据

### 4. 状态管理缺失问题
**问题原因**：实验状态管理逻辑不完善，前端可能没有正确显示状态
**解决方案**：
- 确保实验运行时状态能够自动更新
- 完善前端实验管理页面，正确显示不同状态

### 5. 具体修复步骤
1. **修复因子管理数据获取问题**
   - 修改 `backend/app/services/factor.py` 中的 `get_factors` 函数，添加异常处理
   - 确保即使 `group_id` 字段不存在，也能返回因子数据

2. **修复用户创建失败问题**
   - 检查前端创建用户的请求数据
   - 修改 `backend/app/schemas/auth.py` 中的 `UserCreate` schema，允许 `email` 为空

3. **实现从 QLib 加载实际数据**
   - 修改 `backend/init_db.py` 脚本，使用 `qlib_service.py` 中的方法从 QLib 加载实际数据
   - 确保 `qlib_service.py` 能够正确初始化和使用 QLib

4. **完善状态管理**
   - 确保实验运行时状态能够自动更新
   - 完善前端实验管理页面，正确显示不同状态

5. **测试所有功能**
   - 测试因子管理功能
   - 测试用户创建功能
   - 测试数据管理功能
   - 测试实验管理功能

### 6. 预期结果
- 因子管理页面能够正常显示因子数据
- 用户能够成功创建
- 系统能够从 QLib 加载实际数据
- 实验状态能够正确显示和更新